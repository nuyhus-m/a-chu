== 채팅 관련 API

=== 채팅 시스템 개요

본 시스템은 두 가지 유형의 통신 방식을 사용합니다:

* *HTTP REST API*: 채팅방 생성, 목록 조회 등 상태 변경 및 조회 작업
* *STOMP WebSocket*: 실시간 메시지 전송 및 읽음 상태 업데이트

=== WebSocket 연결 정보

==== STOMP 엔드포인트

WebSocket 연결을 위한 STOMP 엔드포인트 정보입니다.

.엔드포인트
[source]
----
/chat
----

.메시지 브로커 설정
|===
|접두사|용도

|/send
|클라이언트에서 서버로 메시지 전송 시 사용하는 접두사

|/read
|서버에서 클라이언트로 메시지 전송 시 구독할 접두사
|===

=== STOMP WebSocket 엔드포인트

==== 메시지 전송

실시간으로 채팅방에 메시지를 전송합니다.

.요청 대상
[source]
----
/send/chat/rooms/{roomId}/messages
----

.요청 예시
[source,json]
----
{
  "content": "안녕하세요! 상품 구매에 관심이 있습니다.",
  "type": "TEXT"
}
----

.요청 필드
|===
|필드명|타입|설명

|content
|STRING
|채팅 메시지 내용

|type
|STRING
|메시지 타입 (TEXT, IMAGE(이미지는 추후 추가 예정))
|===

.응답 대상
[source]
----
/read/chat/rooms/{roomId}/messages
----

.응답 예시
[source,json]
----
{
  "id": 123,
  "senderId": 456,
  "type": "TEXT",
  "content": "안녕하세요! 상품 구매에 관심이 있습니다.",
  "timestamp": "2023-05-10T14:30:45"
}
----



.응답 필드
|===
|필드명|타입|설명

|id
|NUMBER
|메시지 ID

|senderId
|NUMBER
|발신자 ID

|type
|STRING
|메시지 타입

|content
|STRING
|메시지 내용

|timestamp
|STRING
|메시지 전송 시간
|===

==== 메시지 읽음 상태 업데이트

채팅 메시지의 읽음 상태를 업데이트합니다.

.요청 대상
[source]
----
/send/chat/rooms/{roomId}/messages/read
----

.요청 예시
[source,json]
----
{
  "lastReadMessageId": 123
}
----

.요청 필드
|===
|필드명|타입|설명

|lastReadMessageId
|NUMBER
|마지막으로 읽은 메시지 ID
|===

.응답 대상
[source]
----
/read/chat/rooms/{roomId}/messages/read
----

.응답 예시
[source,json]
----
{
  "userId": 456,
  "lastUnreadMessageId": 123
}
----

.응답 필드
|===
|필드명|타입|설명

|userId
|Long
|사용자 ID

|lastUnreadMessageId
|NUMBER
|마지막으로 읽은 메시지 ID
|===


=== HTTP REST API 엔드포인트

==== 채팅방 생성

새로운 채팅방을 생성합니다.

.HTTP 요청
[source]
----
POST /chat/rooms
----

.요청 예시
[source,json]
----
{
  "goodsId": 789,
  "sellerId": 101,
  "content": "이 상품 아직 판매 중인가요?"
}
----

.요청 필드
|===
|필드명|타입|설명

|goodsId
|NUMBER
|상품 ID

|sellerId
|NUMBER
|판매자 ID

|content
|STRING
|초기 메시지 내용
|===

.응답 예시
[source,json]
----
{
  "success": true,
  "data": {
    "id": 201,
    "goodsId": 789,
    "buyerId": 456,
    "sellerId": 101,
    "isSellerLeft": false,
    "isBuyerLeft": false,
    "goods": {
      "id": 789,
      "title": "아이폰 14 프로 맥스",
      "price": 1200000,
      "thumbnailUrl": "https://example.com/images/iphone.jpg"
    },
    "partner": {
      "id": 101,
      "nickname": "애플매니아",
      "profileImageUrl": "https://example.com/profiles/user101.jpg"
    },
    "lastMessage": {
      "id": 123,
      "senderId": 456,
      "content": "이 상품 아직 판매 중인가요?",
      "type": "TEXT",
      "timestamp": "2023-05-10T14:30:45"
    }
  }
}
----


.응답 필드
|===
|필드명|타입|설명

|success
|BOOLEAN
|API 요청 성공 여부

|data
|OBJECT
|응답 데이터 객체

|data.id
|NUMBER
|채팅방 ID

|data.goodsId
|NUMBER
|상품 ID

|data.buyerId
|NUMBER
|구매자 ID

|data.sellerId
|NUMBER
|판매자 ID

|data.isSellerLeft
|BOOLEAN
|판매자 퇴장 여부

|data.isBuyerLeft
|BOOLEAN
|구매자 퇴장 여부

|data.goods
|OBJECT
|상품 정보

|data.goods.id
|NUMBER
|상품 ID

|data.goods.title
|STRING
|상품 제목

|data.goods.price
|NUMBER
|상품 가격

|data.goods.thumbnailUrl
|STRING
|상품 썸네일 이미지 URL

|data.partner
|OBJECT
|상대방 정보

|data.partner.id
|NUMBER
|상대방 ID

|data.partner.nickname
|STRING
|상대방 닉네임

|data.partner.profileImageUrl
|STRING
|상대방 프로필 이미지 URL

|data.lastMessage
|OBJECT
|마지막 메시지 정보

|data.lastMessage.id
|NUMBER
|마지막 메시지 ID

|data.lastMessage.senderId
|NUMBER
|마지막 메시지 발신자 ID

|data.lastMessage.content
|STRING
|마지막 메시지 내용

|data.lastMessage.type
|STRING
|마지막 메시지 타입

|data.lastMessage.timestamp
|STRING
|마지막 메시지 전송 시간

|===


==== 채팅방 목록 조회

사용자가 참여한 모든 채팅방 목록을 조회합니다.

.HTTP 요청
[source]
----
GET /chat/rooms
----

.응답 예시
[source,json]
----
{
  "success": true,
  "data": [
    {
      "id": 201,
      "goodsId": 789,
      "buyerId": 456,
      "sellerId": 101,
      "isSellerLeft": false,
      "isBuyerLeft": false,
      "goods": {
        "id": 789,
        "title": "아이폰 14 프로 맥스",
        "price": 1200000,
        "thumbnailUrl": "https://example.com/images/iphone.jpg"
      },
      "partner": {
        "id": 101,
        "nickname": "애플매니아",
        "profileImageUrl": "https://example.com/profiles/user101.jpg"
      },
      "lastMessage": {
        "id": 123,
        "senderId": 456,
        "content": "이 상품 아직 판매 중인가요?",
        "type": "TEXT",
        "timestamp": "2023-05-10T14:30:45"
      }
    },
    {
      "id": 202,
      "goodsId": 790,
      "buyerId": 456,
      "sellerId": 102,
      "isSellerLeft": false,
      "isBuyerLeft": false,
      "goods": {
        "id": 790,
        "title": "갤럭시 S23 울트라",
        "price": 1100000,
        "thumbnailUrl": "https://example.com/images/galaxy.jpg"
      },
      "partner": {
        "id": 102,
        "nickname": "삼성팬",
        "profileImageUrl": "https://example.com/profiles/user102.jpg"
      },
      "lastMessage": {
        "id": 145,
        "senderId": 102,
        "content": "네, 아직 판매 중입니다!",
        "type": "TEXT",
        "timestamp": "2023-05-10T15:45:20"
      }
    }
  ]
}
----


.응답 필드
|===
|필드명|타입|설명

|success
|BOOLEAN
|API 요청 성공 여부

|data
|ARRAY
|채팅방 목록

|data[].id
|NUMBER
|채팅방 ID

|data[].goodsId
|NUMBER
|상품 ID

|data[].buyerId
|NUMBER
|구매자 ID

|data[].sellerId
|NUMBER
|판매자 ID

|data[].isSellerLeft
|BOOLEAN
|판매자 퇴장 여부

|data[].isBuyerLeft
|BOOLEAN
|구매자 퇴장 여부

|data[].goods
|OBJECT
|상품 정보

|data[].goods.id
|NUMBER
|상품 ID

|data[].goods.title
|STRING
|상품 제목

|data[].goods.price
|NUMBER
|상품 가격

|data[].goods.thumbnailUrl
|STRING
|상품 썸네일 이미지 URL

|data[].partner
|OBJECT
|상대방 정보

|data[].partner.id
|NUMBER
|상대방 ID

|data[].partner.nickname
|STRING
|상대방 닉네임

|data[].partner.profileImageUrl
|STRING
|상대방 프로필 이미지 URL

|data[].lastMessage
|OBJECT
|마지막 메시지 정보

|data[].lastMessage.id
|NUMBER
|마지막 메시지 ID

|data[].lastMessage.senderId
|NUMBER
|마지막 메시지 발신자 ID

|data[].lastMessage.content
|STRING
|마지막 메시지 내용

|data[].lastMessage.type
|STRING
|마지막 메시지 타입

|data[].lastMessage.timestamp
|STRING
|마지막 메시지 전송 시간

|===

==== 안 읽은 메시지 수 조회

사용자의 안 읽은 전체 메시지 수를 조회합니다.

.HTTP 요청
[source]
----
GET /chat/unread-count
----

.응답 예시
[source,json]
----
{
  "success": true,
  "data": {
    "unreadCount": 5
  }
}
----

.응답 필드
|===
|필드명|타입|설명

|success
|BOOLEAN
|API 요청 성공 여부

|data
|OBJECT
|응답 데이터 객체

|data.unreadCount
|NUMBER
|안 읽은 메시지 총 개수

|===
